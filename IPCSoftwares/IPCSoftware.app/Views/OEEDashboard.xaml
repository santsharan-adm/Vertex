<UserControl x:Class="IPCSoftware.App.Views.OEEDashboard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:controls="clr-namespace:IPCSoftware.App.Controls"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:bh="clr-namespace:IPCSoftware.App.Behaviors"
             xmlns:conv="clr-namespace:IPCSoftware.App.Converters"
             xmlns:helpers="clr-namespace:IPCSoftware.App.Helpers"
             xmlns:vm="clr-namespace:IPCSoftware.App.ViewModels"
             helpers:ThemeManager.ThemeSource="{Binding CurrentThemePath}"
             helpers:ViewModelLocator.AutoWireViewModel="{x:Type vm:OEEDashboardViewModel}"
             Background="{DynamicResource PageBackgroundBrush}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/IPCSoftware.App;component/Styles/DarkTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <conv:ResultToColorConverter x:Key="ResultToColor"/>

            <Style x:Key="DashboardCard" TargetType="Border">
                <Setter Property="Background" Value="{DynamicResource CardBackgroundBrush}"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="Padding" Value="15"/>
                <Setter Property="Margin" Value="8"/>
                <Setter Property="Effect">
                    <Setter.Value>
                        <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="2" Opacity="0.1"/>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="KpiLabel" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource SecondaryTextBrush}"/>
                <Setter Property="FontSize" Value="32"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,0,0,10"/>
            </Style>

            <Style x:Key="KpiValue" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource PrimaryTextBrush}"/>
                <Setter Property="FontSize" Value="56"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="HorizontalAlignment" Value="Center"/>
            </Style>

            <Style TargetType="ProgressBar" x:Key="RoundedProgressBarStyle">
                <Setter Property="Height" Value="10"/>
                <Setter Property="Margin" Value="0,5,0,5"/>
                <Setter Property="BorderThickness" Value="0"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ProgressBar">
                            <Grid>
                                <Border Name="PART_Track" 
                                        Background="{DynamicResource BorderBrush}" 
                                        CornerRadius="5"/>
                                <Border Name="PART_Indicator" 
                                        HorizontalAlignment="Left" 
                                        Background="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Foreground}"
                                        CornerRadius="5"/>
                            </Grid>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Grid.Row="0" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,2" Margin="0,0,0,20" Padding="0,0,0,10">
                <Grid>
                    <TextBlock Text="AOI INSPECTION DASHBOARD"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               FontSize="36"
                               FontWeight="Bold"
                               VerticalAlignment="Center"/>

                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <Button Command="{Binding ToggleThemeCommand}" 
                                Content="🌗 Theme"
                                Width="120" Height="40"
                                FontSize="20" FontWeight="SemiBold"
                                Margin="0,0,30,0"
                                Background="{DynamicResource CardBackgroundBrush}"
                                Foreground="{DynamicResource PrimaryTextBrush}"
                                BorderBrush="{DynamicResource BorderBrush}"
                                BorderThickness="1">
                            <Button.Resources>
                                <Style TargetType="Border">
                                    <Setter Property="CornerRadius" Value="8"/>
                                </Style>
                            </Button.Resources>
                        </Button>

                        <Ellipse Width="20" Height="20" Fill="{DynamicResource SuccessBrush}" Margin="0,0,10,0"/>
                        <TextBlock Text="MACHINE RUNNING" Foreground="{DynamicResource SuccessBrush}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
            </Border>

            <Grid Grid.Row="1" Margin="0,0,0,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                   
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="OPERATING TIME" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="05:42:17" Style="{StaticResource KpiValue}" Foreground="{DynamicResource InfoBrush}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="1" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="DOWNTIME" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="00:12:45" Style="{StaticResource KpiValue}" Foreground="{DynamicResource DangerBrush}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="2" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="AVG CYCLE (SEC)" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="2.9" Style="{StaticResource KpiValue}" Foreground="{DynamicResource WarningBrush}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="3" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="IN FLOW" Foreground="{DynamicResource SecondaryTextBrush}" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="1165" Foreground="{DynamicResource PrimaryTextBrush}" Style="{StaticResource KpiValue}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="4" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="OK" Foreground="{DynamicResource SuccessBrush}" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="1140" Foreground="{DynamicResource SuccessBrush}" Style="{StaticResource KpiValue}"/>
                    </StackPanel>
                </Border>

                <Border Grid.Column="5" Style="{StaticResource DashboardCard}">
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="NG" Foreground="{DynamicResource DangerBrush}" Style="{StaticResource KpiLabel}"/>
                        <TextBlock Text="25" Foreground="{DynamicResource DangerBrush}" Style="{StaticResource KpiValue}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="1.2*"/>
                        <RowDefinition Height="1.5*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource DashboardCard}" Margin="0,0,10,10">
                            <Grid Margin="10">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Text="Efficiency Breakdown" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30" FontWeight="SemiBold" VerticalAlignment="Top"/>

                                <StackPanel Grid.Row="1" VerticalAlignment="Center">
                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="50"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Availability" FontSize="25" Foreground="{DynamicResource SecondaryTextBrush}" FontWeight="Medium" VerticalAlignment="Center"/>
                                        <ProgressBar Grid.Column="1" Value="85" Maximum="100" 
                                                     Foreground="{DynamicResource InfoBrush}"
                                                     Style="{StaticResource RoundedProgressBarStyle}"/>
                                        <TextBlock Grid.Column="2" Text="85%" Foreground="{DynamicResource PrimaryTextBrush}" FontWeight="SemiBold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    </Grid>

                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="50"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Performance" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="25" FontWeight="Medium" VerticalAlignment="Center"/>
                                        <ProgressBar Grid.Column="1" Value="95" Maximum="100" 
                                                     Foreground="{DynamicResource WarningBrush}"
                                                     Style="{StaticResource RoundedProgressBarStyle}"/>
                                        <TextBlock Grid.Column="2" Text="95%" Foreground="{DynamicResource PrimaryTextBrush}" FontWeight="SemiBold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    </Grid>

                                    <Grid Margin="0,5">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="50"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Quality" FontSize="25" Foreground="{DynamicResource SecondaryTextBrush}" FontWeight="Medium" VerticalAlignment="Center"/>
                                        <ProgressBar Grid.Column="1" Value="97" Maximum="100" 
                                                     Foreground="{DynamicResource SuccessBrush}"
                                                     Style="{StaticResource RoundedProgressBarStyle}"/>
                                        <TextBlock Grid.Column="2"  Text="97%" Foreground="{DynamicResource PrimaryTextBrush}" FontWeight="SemiBold" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource DashboardCard}" Margin="10,0,0,10">
                            <Viewbox Stretch="Uniform">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Stretch" Width="250">

                                    <TextBlock Text="Overall Equipment Effectiveness" 
                       Foreground="{DynamicResource PrimaryTextBrush}" 
                       FontSize="20" 
                       FontWeight="SemiBold" 
                       HorizontalAlignment="Center" 
                       TextAlignment="Center" 
                       TextWrapping="Wrap"
                       Margin="0,0,0,10"/>

                                    <Grid Width="160" Height="160" Margin="0,5">
                                        <Ellipse Fill="{DynamicResource BorderBrush}" />

                                        <Path StrokeThickness="15" HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <Path.Data>
                                                <PathGeometry Figures="M 80,5 A 75,75 0 1 1 5,80" />
                                            </Path.Data>
                                            <Path.Stroke>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop Color="#4CAF50" Offset="0"/>
                                                    <GradientStop Color="#8BC34A" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Path.Stroke>
                                        </Path>

                                        <Ellipse Width="130" Height="130" Fill="{DynamicResource CardBackgroundBrush}" HorizontalAlignment="Center" VerticalAlignment="Center"/>

                                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                            <TextBlock Text="78" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="48" FontWeight="Bold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="%" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center" Margin="0,-5,0,0"/>
                                        </StackPanel>
                                    </Grid>

                                    <TextBlock Text="Target: 85%" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="16" HorizontalAlignment="Center" Margin="0,5,0,0"/>
                                </StackPanel>
                            </Viewbox>
                        </Border>
                    </Grid>

                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="1.2*"/>
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0" Style="{StaticResource DashboardCard}" Margin="0,10,10,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Text="Cycle Time Trend (Last 7 Days)" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="22" FontWeight="SemiBold" Margin="0,0,0,10"/>
                                <controls:TrendChart Grid.Row="1" Values="{Binding CycleTrend}"/>
                            </Grid>
                        </Border>

                        <Border Grid.Column="1" Style="{StaticResource DashboardCard}" Margin="10,10,0,0">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <TextBlock Grid.Row="0" Text="Latest Measurements" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30" FontWeight="SemiBold" Margin="0,0,0,20"/>

                                <Grid Grid.Row="1" Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="PARAM" Foreground="{DynamicResource TableHeaderBrush}" FontSize="25" FontWeight="Bold"/>
                                    <TextBlock Grid.Column="1" Text="VALUE" Foreground="{DynamicResource TableHeaderBrush}" FontSize="25" FontWeight="Bold" HorizontalAlignment="Center"/>
                                    <TextBlock Grid.Column="2" Text="TOLERANCE" Foreground="{DynamicResource TableHeaderBrush}" FontSize="25" FontWeight="Bold" HorizontalAlignment="Right"/>
                                </Grid>

                                <StackPanel Grid.Row="2">
                                    <Grid Margin="0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Height" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30"/>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="3.45 mm" Foreground="{DynamicResource SuccessBrush}" FontSize="30" FontWeight="Bold"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="2" Text="±0.10" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30" HorizontalAlignment="Right"/>
                                    </Grid>
                                    <Separator Background="{DynamicResource BorderBrush}"/>

                                    <Grid Margin="0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Width" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30"/>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="5.23 mm" Foreground="{DynamicResource DangerBrush}" FontSize="30" FontWeight="Bold"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="2" Text="±0.10" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30" HorizontalAlignment="Right"/>
                                    </Grid>
                                    <Separator Background="{DynamicResource BorderBrush}"/>

                                    <Grid Margin="0,10">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Offset" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30"/>
                                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="0.02 mm" Foreground="{DynamicResource SuccessBrush}" FontSize="30" FontWeight="Bold"/>
                                        </StackPanel>
                                        <TextBlock Grid.Column="2" Text="±0.05" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="30" HorizontalAlignment="Right"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </Grid>

                <Grid Grid.Column="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Style="{StaticResource DashboardCard}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Border Background="White" Padding="5" CornerRadius="5">
                                <Image Source="pack://application:,,,/IPCSoftware.App;component/Controls/Images/qrcode.png"
                                       Height="120" Width="120"/>
                            </Border>

                            <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="20,0,0,0">
                                <TextBlock Text="Active Batch Code" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="18"/>
                                <TextBlock Text="XS12345F-2025" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="36" FontWeight="Bold" Margin="0,5,0,0"/>
                                <TextBlock Text="Scanned: 10:42 AM" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="16" Margin="0,5,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <Border Grid.Row="1" Style="{StaticResource DashboardCard}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <TextBlock Text="Live Inspection Feed" Foreground="{DynamicResource PrimaryTextBrush}" FontSize="22" FontWeight="SemiBold" Margin="0,0,0,15"/>

                            <ItemsControl Grid.Row="1" ItemsSource="{Binding CameraImages}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <UniformGrid Rows="4" Columns="3"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border CornerRadius="8" Margin="5" Background="#111" BorderBrush="{Binding Result, Converter={StaticResource ResultToColor}}" BorderThickness="3">
                                            <Grid>
                                                <Image Source="{Binding ImagePath}" Stretch="UniformToFill">
                                                    <i:Interaction.Behaviors>
                                                        <helpers:ImageClickBehavior Command="{Binding DataContext.ShowImageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"/>
                                                    </i:Interaction.Behaviors>
                                                </Image>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Grid>
                    </Border>
                </Grid>
            </Grid>
        </Grid>
    </Grid>
</UserControl>