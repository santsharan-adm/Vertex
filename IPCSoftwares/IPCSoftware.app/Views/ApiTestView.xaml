<UserControl x:Class="IPCSoftware.App.Views.ApiTestView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:helpers="clr-namespace:IPCSoftware.App.Helpers"
             xmlns:vm="clr-namespace:IPCSoftware.App.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="1080" d:DesignWidth="1920"
             helpers:ViewModelLocator.AutoWireViewModel="{x:Type vm:ApiTestViewModel}">
    <Grid Background="#F5F7FA" Margin="40" TextElement.FontSize="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <StackPanel Grid.Column="0" Margin="0,0,30,0">
            <TextBlock Text="API Test Console" FontSize="46" FontWeight="Bold" Foreground="#333" />
            <Border Background="White" CornerRadius="12" Padding="25" BorderBrush="#E0E0E0" BorderThickness="1">
                <StackPanel>
                    <!-- ... Existing Inputs (Protocol, Host, Endpoint, Params) ... -->
                    <UniformGrid Columns="2" Rows="3" Margin="0,0,0,10">
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Protocol" FontWeight="SemiBold" />
                            <ComboBox ItemsSource="{Binding ProtocolOptions}" SelectedItem="{Binding SelectedProtocol}" Height="40" />
                        </StackPanel>
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Host (IP:Port for TCP)" FontWeight="SemiBold" />
                            <TextBox Text="{Binding Host, UpdateSourceTrigger=PropertyChanged}" Height="40" />
                        </StackPanel>
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Endpoint / Prefix" FontWeight="SemiBold" />
                            <TextBox Text="{Binding Endpoint, UpdateSourceTrigger=PropertyChanged}" Height="40" />
                        </StackPanel>
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Carrier Serial Number" FontWeight="SemiBold" />
                            <TextBox Text="{Binding TwoDCodeData, UpdateSourceTrigger=PropertyChanged}" Height="40" />
                        </StackPanel>
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Previous Station Code" FontWeight="SemiBold" />
                            <TextBox Text="{Binding PreviousStationCode, UpdateSourceTrigger=PropertyChanged}" Height="40" />
                        </StackPanel>
                        <StackPanel Margin="0,0,15,10">
                            <TextBlock Text="Current Station ID" FontWeight="SemiBold" />
                            <TextBox Text="{Binding CurrentMachineCode, UpdateSourceTrigger=PropertyChanged}" Height="40" />
                        </StackPanel>
                    </UniformGrid>

                    <!-- Preview Section -->
                    <StackPanel Visibility="{Binding HasRequestPreview, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBlock Text="Request Preview" FontWeight="SemiBold" />
                        <TextBox Text="{Binding RequestPreview}" IsReadOnly="True" Height="80" Background="#F0F3F8" TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Orientation="Horizontal" Margin="0,20,0,0" HorizontalAlignment="Left">
                        <Button Content="Ping Test" Height="50" Width="120" Margin="0,0,10,0" Background="#6366F1" Foreground="White" Command="{Binding PingTestCommand}" />
                        <Button Content="Save Settings" Height="50" Width="140" Margin="0,0,10,0" Background="#10B981" Foreground="White" Command="{Binding SaveSettingsCommand}" />
                        <Button Content="TEST" Height="50" Width="120" FontWeight="Bold" Background="#007ACC" Foreground="White" Command="{Binding TestApiCommand}" />

                        <!-- NEW: Disconnect Button for TCP -->
                        <Button Content="Disconnect TCP" Height="50" Width="140" Margin="10,0,0,0" Background="#EF4444" Foreground="White" Command="{Binding CloseTcpCommand}">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SelectedProtocol}" Value="tcp">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>
        </StackPanel>

        <!-- Right Column: Results -->
        <Border Grid.Column="1" Background="White" CornerRadius="12" Padding="20" BorderBrush="#E0E0E0" BorderThickness="1">
            <StackPanel>
                <TextBlock Text="Ping Result" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,10" />
                <TextBox Text="{Binding PingResult}" IsReadOnly="True" TextWrapping="Wrap" Background="#F9FAFB" Height="80" />

                <TextBlock Text="Response Log" FontSize="20" FontWeight="SemiBold" Margin="0,20,0,10" />
                <TextBox Text="{Binding ResultText}" IsReadOnly="True" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" Height="400" Background="#0A0A0F" Foreground="#D4F1FF" FontFamily="Consolas" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
